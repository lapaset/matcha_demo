(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{132:function(e,t,a){},133:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(21),o=a.n(c),l=a(14),s=a(22),i=a(8),u=a(7),m=a(18),f=a(5),d=a.n(f),p=a(9),h=a(10),b=a.n(h),g=null,E=function(e){g="bearer ".concat(e)},v=function(){return{headers:{Authorization:g}}},w="/api/users",j=function(e){var t=[];return e?(e.includes("f")&&t.push("female"),e.includes("m")&&t.push("male"),e.includes("o")&&t.push("other"),t):t},O=function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get(w,v());case 2:return t=e.sent,e.abrupt("return",t.data.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{orientation:j(e.orientation)})})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=Object(p.a)(d.a.mark((function e(t){var a,n,r,c,o,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,b.a.get("".concat(w,"/").concat(t),v());case 4:if((a=e.sent).data[0]){e.next=7;break}return e.abrupt("return",a.data);case 7:return n=a.data[0],r=n.first_name,c=n.last_name,n.id,n.profile_pic,n.photo_str,o=n.orientation,l=Object(s.a)(n,["first_name","last_name","id","profile_pic","photo_str","orientation"]),a.data[0].id&&void 0!==a.data[0].profile_pic&&a.data[0].photo_str&&(l.photos=a.data.map((function(e){return{id:e.id,photoStr:e.photo_str,profilePic:e.profile_pic}}))),e.abrupt("return",Object(i.a)(Object(i.a)({},l),{},{firstName:r,lastName:c,orientation:j(o),age:a.data[0].age.years}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(p.a)(d.a.mark((function e(t,a){var n,r,c,o,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.patch("".concat(w,"/").concat(a),t,v());case 2:return(n=e.sent).data.first_name&&(r=n.data,c=r.first_name,Object(s.a)(r,["first_name"]).firstName=c),n.data.last_name&&(o=n.data,l=o.last_name,Object(s.a)(o,["last_name"]).lastName=l),n.data.orientation&&(t.orientation=j(n.data.orientation)),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),k=function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post(w,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N={getAll:O,getUser:x,updateUser:y,createUser:k,getByGenderOrientation:function(){var e=Object(p.a)(d.a.mark((function e(t,a){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.substring(0,1)})).join(""),e.next=3,b.a.get("".concat(w,"?gender=").concat(n,"&orientation=").concat(a.substring(0,1)),v());case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},_={getNotifications:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/notifications","?user_id=").concat(t),v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),notify:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/notifications",t,v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),markAsRead:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.patch("".concat("/api/notifications","/").concat(t),{read:1},v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),markAllAsRead:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.patch("".concat("/api/notifications"),{read:1},v());case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},S={getLikes:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/likes"),v());case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getLikesToUser:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/likes","?to=true"),v());case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getLike:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/likes","?to_user_id=").concat(t),v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMatches:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/likes","?match=1"),v());case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),toggleLike:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/likes",{to_user_id:t},v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},C={getChatHistory:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/chat"),v());case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},U=a(91),L=function(e){var t=new U.w3cwebsocket("ws://127.0.0.1:3001");return t.onerror=function(){console.log("Websocket connection error")},t.onopen=function(){console.log("Websocket client connected"),t.send(JSON.stringify({type:"connected",from:e}))},t.onclose=function(){console.log("Websocket connection closed"),t.send(JSON.stringify({type:"closed",from:e}))},t},P=function(e,t){e.current?e.current.readyState>1?console.log("Error: could not send notification, websocket state",e.current.readyState):e.current.send(JSON.stringify(Object(i.a)(Object(i.a)({},t),{},{type:"notification"}))):console.log("Error: could not send notification, no websocket")},F=a(17),D=a(142),T=a(92),M=a(143),A=a(139),R=a(93),V=a(13),B=a(12),I=a(148),H={addPhoto:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/photos",t,v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),deletePhoto:function(){var e=Object(p.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.delete("".concat("/api/photos","/").concat(t),v());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),toggleProfilePhoto:function(){var e=Object(p.a)(d.a.mark((function e(t,a){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.put("".concat("/api/photos","/").concat(t),{profilePic:a},v());case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},G=a(140),q=a(149),z=function(e){var t=e.photo,a=e.setPhoto,c=e.profilePic,o=e.setUploadDisabled,l=Object(n.useState)(null),s=Object(u.a)(l,2),i=s[0],m=s[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,{className:"text-center"},t.photoStr?r.a.createElement(A.a,{aspectRatio:"1by1"},r.a.createElement("div",{className:"border d-flex"},r.a.createElement(G.a,{src:t.photoStr,alt:"upload preview",title:"upload preview",className:"img-fluid d-block m-auto",style:{maxWidth:"100%",maxHeight:"100%"}}))):null,r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"upload",className:"btn btn-primary mt-3"},"Choose photo"),r.a.createElement(q.a.Control,{id:"upload",type:"file",accept:".png, .jpg, .jpeg",onChange:function(e){e.preventDefault();var n=new FileReader,r=e.target.files[0];if(r){if(r.size>35e4)return m("Max photo size is 350kb"),void(t||o(!0));n.onloadend=function(){a({photoStr:n.result,profilePic:c})},n.readAsDataURL(r),o(!1),m("")}}})),i&&r.a.createElement("div",{className:"text-center text-danger"},i)))},W=function(e){var t=e.user,a=e.setUser,c=e.showModal,o=e.closeModal,l=Object(n.useState)({}),s=Object(u.a)(l,2),m=s[0],f=s[1],d=Object(n.useState)(!0),p=Object(u.a)(d,2),h=p[0],b=p[1];return r.a.createElement(I.a,{show:c,onHide:o},r.a.createElement(I.a.Header,{closeButton:!0},r.a.createElement(I.a.Title,null,"Upload photo")),r.a.createElement(I.a.Body,null,r.a.createElement(z,{photo:m,setPhoto:f,profilePic:t.photos&&t.photos.length>0?0:1,setUploadDisabled:b})),r.a.createElement(I.a.Footer,null,r.a.createElement(R.a,{variant:"secondary",onClick:o},"Close"),r.a.createElement(R.a,{variant:"primary",onClick:function(e){e.preventDefault(),H.addPhoto(Object(i.a)({user_id:t.user_id},m)).then((function(e){var n=Object(i.a)({id:e.id},m),r=Object(i.a)(Object(i.a)({},t),{},{photos:t.photos?t.photos.concat(n):[n]});o(),f({}),b(!0),a(r)})).catch((function(e){console.log("Database error",e)}))},disabled:h},"Upload")))},J=function(e){var t=e.user,a=e.setUser,c=Object(n.useState)(!1),o=Object(u.a)(c,2),l=o[0],s=o[1];return r.a.createElement(A.a,{aspectRatio:"1by1"},r.a.createElement("div",{className:"border d-flex align-items-center"},r.a.createElement(R.a,{size:"sm",variant:"light",onClick:function(){return s(!0)},style:{position:"absolute",bottom:"5px",right:"5px"}},r.a.createElement(V.a,{icon:B.h})),r.a.createElement(W,{user:t,setUser:a,showModal:l,closeModal:function(){return s(!1)}})))},Z=a(141),Y=function(e){var t=e.photo,a=e.profilePic,n=e.user,c=e.setUser;return t.profilePic?r.a.createElement(R.a,{size:"sm",variant:"light",disabled:!0},r.a.createElement(V.a,{icon:B.l,color:"gold"})):r.a.createElement(R.a,{size:"sm",variant:"light",onClick:function(){H.toggleProfilePhoto(t.id,1).then((function(){H.toggleProfilePhoto(a.id,0).then((function(){var e=Object(i.a)(Object(i.a)({},n),{},{photos:n.photos.map((function(e){return e.id===t.id?Object(i.a)(Object(i.a)({},e),{},{profilePic:1}):e.id=a.id?Object(i.a)(Object(i.a)({},e),{},{profilePic:0}):e}))});c(e)})).catch((function(e){console.log("Database error",e)}))})).catch((function(e){console.log("Database error",e)}))}},r.a.createElement(V.a,{icon:B.l}))},$=function(e){var t=e.photo,a=e.user,n=e.setUser;return r.a.createElement(R.a,{size:"sm",variant:"danger",onClick:function(){H.deletePhoto(t.id).then((function(){if(t.profilePic){var e=a.photos.find((function(e){return!e.profilePic}));if(e)H.toggleProfilePhoto(e.id,1).then((function(){var r=Object(i.a)(Object(i.a)({},a),{},{photos:a.photos.filter((function(e){return e.id!==t.id})).map((function(t){return t.id===e.id?Object(i.a)(Object(i.a)({},t),{},{profilePic:1}):t}))});n(r)})).catch((function(e){console.log("Database error",e)}));else{var r=Object(i.a)(Object(i.a)({},a),{},{photos:a.photos.filter((function(e){return e.id!==t.id}))});n(r)}}else{var c=Object(i.a)(Object(i.a)({},a),{},{photos:a.photos.filter((function(e){return e.id!==t.id}))});n(c)}})).catch((function(e){console.log("Database error",e)}))}},r.a.createElement(V.a,{icon:B.k}))},K=function(e){var t=e.photo,a=e.user,c=e.setUser,o=e.profilePic,l=Object(n.useState)(!1),s=Object(u.a)(l,2),i=s[0],m=s[1],f={maxWidth:i?"101%":"100%",maxHeight:i?"101%":"100%"},d={display:i?"block":"none",position:"absolute",bottom:"5px",right:"5px"};return r.a.createElement(A.a,{aspectRatio:"1by1"},r.a.createElement("div",{className:"border d-flex align-items-center img-fluid",onMouseEnter:function(){return m(!0)},onMouseLeave:function(){return m(!1)}},r.a.createElement(G.a,{src:t.photoStr,alt:a.username,title:a.username,className:"d-block m-auto",style:f}),r.a.createElement(Z.a,{style:d},r.a.createElement(Y,{photo:t,profilePic:o,user:a,setUser:c}),r.a.createElement($,{photo:t,user:a,setUser:c}))))},Q=function(e){var t=e.user,a=e.setUser,c=Object(n.useState)(null),o=Object(u.a)(c,2),s=o[0],i=o[1],m=function(){return t.photos?5-t.photos.length:5};return Object(n.useEffect)((function(){t.photos&&t.photos.length>0?i(t.photos.find((function(e){return e.profilePic}))):i(null)}),[t.photos]),r.a.createElement(D.a,null,r.a.createElement(M.a,{noGutters:!0},s?r.a.createElement(T.a,null,r.a.createElement(K,{photo:s,user:t,setUser:a,profilePic:s})):null),r.a.createElement(M.a,{noGutters:!0},t.photos?t.photos.map((function(e){return e.profilePic?null:r.a.createElement(T.a,{xs:6,key:e.id},r.a.createElement(K,{photo:e,user:t,setUser:a,profilePic:s}))})):null,m()?Object(l.a)(Array(m())).map((function(e,n){return r.a.createElement(T.a,{xs:6,key:n},r.a.createElement(J,{photo:null,user:t,setUser:a}))})):null))},X=a(34),ee=function(e){var t=e.label,a=e.errors,n=e.name,c=e.defVal,o=e.maxLen,l=e.requirements,s=e.register;return r.a.createElement(q.a.Group,{className:"text-left"},r.a.createElement(q.a.Label,{htmlFor:"form-".concat(n)},t),a&&r.a.createElement("span",{className:"text-danger"}," ",a.message),r.a.createElement("br",null),r.a.createElement(q.a.Control,{id:"form-".concat(n),name:n,defaultValue:c,maxLength:o,ref:s(Object(i.a)(Object(i.a)({},l),{},{required:{value:!0,message:"*"},maxLength:{value:o,message:"max length ".concat(o)}}))}))},te=function(e){var t=e.watch,a=e.register,c=e.required,o=e.errors,l=Object(n.useRef)({});return l.current=t("password",""),r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a.Group,{className:"text-left"},r.a.createElement(q.a.Label,null,"password"),o.password&&"*"===o.password.message&&r.a.createElement("span",{className:"text-danger"}," ",o.password.message),r.a.createElement("br",null),r.a.createElement("input",{className:"form-control",name:"password",type:"password",defaultValue:"",maxLength:"50",placeholder:"password",ref:a({required:{value:c,message:"*"},maxLength:{value:50,message:"max length 50"},minLength:{value:8,message:"min length 8"},pattern:{value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/,message:"must contain a number, an upper and a lower case letter"}})}),o.password&&"*"!==o.password.message?r.a.createElement("p",{className:"text-danger"},o.password.message):r.a.createElement("p",null)),r.a.createElement(q.a.Group,{className:"text-left"},r.a.createElement("input",{className:"form-control",name:"password2",type:"password",defaultValue:"",maxLength:"50",placeholder:"confirm password",ref:a({validate:function(e){return e===l.current||"passwords don't match"}})}),o.password2&&r.a.createElement("p",{className:"text-danger"},o.password2.message)))},ae=a(39),ne=function(e){var t=e.gender,a=e.control,n=e.errors;return r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"select-gender"},"gender"),n.gender&&"required"===n.gender.type&&r.a.createElement("span",{className:"text-danger"}," *"),r.a.createElement("br",null),r.a.createElement(X.a,{class:"form-control",id:"select-gender",name:"gender",as:ae.a,options:[{value:"female",label:"female"},{value:"male",label:"male"},{value:"other",label:"other"}],value:{value:t,label:t},defaultValue:t?{value:t,label:t}:"",control:a,rules:{required:!0}}))},re=function(e){var t=e.orientation,a=e.control,n=e.errors,c=function(){return t?t.map((function(e){return{value:e,label:e}})):""};return r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"select-orientation"},"looking for"),n.orientation&&"required"===n.orientation.type&&r.a.createElement("span",{className:"text-danger"}," *"),r.a.createElement("br",null),r.a.createElement(X.a,{class:"form-control",id:"select-orientation",name:"orientation",as:ae.a,options:[{value:"female",label:"female"},{value:"male",label:"male"},{value:"other",label:"other"}],value:c(),defaultValue:c(),control:a,rules:{required:!0},isMulti:!0}))},ce={getTags:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("/api/tags");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),addTag:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/tags",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},oe=function(e){var t=e.state,a=e.setState,c=Object(n.useState)([]),o=Object(u.a)(c,2),s=o[0],i=o[1],m=function(e){return{label:e,value:e}};return Object(n.useEffect)((function(){ce.getTags().then((function(e){i(e.map((function(e){return m(e.tag)})))})).catch((function(e){console.log(e)}))}),[]),r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"tags-select"},"tags"),r.a.createElement(ae.a,{id:"tags-select",inputValue:t.inputValue,isClearable:!0,isMulti:!0,onChange:function(e){a({value:e})},onInputChange:function(e){a({inputValue:e,value:t.value||[]})},onKeyDown:function(e){var n=t.inputValue,r=t.value;if(n)switch(e.key){case"Enter":case"Tab":e.preventDefault();var c=n.startsWith("#")?n:"#"+n;if(void 0!==r.find((function(e){return e.label===c})))return;if(void 0!==s.find((function(e){return e.label===c})))return a({inputValue:"",value:[].concat(Object(l.a)(r),[m(c)])}),void i(s.filter((function(e){return e.label!==c})));ce.addTag({tag:c}).then((function(){a({inputValue:"",value:[].concat(Object(l.a)(r),[m(c)])}),i(s.concat(m(c)))})).catch((function(e){console.log("Database error",e)}));break;default:return}},value:t.value,options:s,name:"tags"}))},le=function(e){var t=e.bio,a=e.register,n=e.errors;return r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"bio-textarea"},"bio"),r.a.createElement("br",null),r.a.createElement(q.a.Control,{as:"textarea",id:"bio-textarea",name:"bio",defaultValue:t,maxLength:"1000",ref:a({maxLength:{value:1e3,message:"max length 1000"}})}),n&&r.a.createElement("p",{className:"text-danger"},n.message))},se=function(e){return e?3===e.length?"fmo":1===e.length?e[0].value.substring(0,1):e.map((function(e){return e.value})).find((function(e){return"female"===e}))?e.map((function(e){return e.value})).find((function(e){return"male"===e}))?"fm":"fo":"mo":""},ie=function(e){return e?e.split("#").map((function(e){return{label:"#".concat(e),value:"#".concat(e)}})).slice(1):[]},ue=function(e){var t=e.user,a=e.setUser,c=Object(n.useState)(""),o=Object(u.a)(c,2),l=o[0],m=o[1],f=Object(n.useState)(""),d=Object(u.a)(f,2),p=d[0],h=d[1],b=Object(n.useState)({value:ie(t.tags),inputValue:""}),g=Object(u.a)(b,2),E=g[0],v=g[1],w=Object(X.b)(),j=w.register,O=w.handleSubmit,x=w.errors,y=w.control,k=w.watch,_=w.reset;return r.a.createElement(q.a,{onSubmit:O((function(e){var n=e.password,r=(e.password2,Object(s.a)(e,["password","password2"]));r.gender=e.gender.value,r.orientation=se(e.orientation),r.tags=E.value&&0!==E.value.length?E.value.map((function(e){return e.value})).join(""):"",n&&(r.password=n,_({password:"",password2:""})),N.updateUser(r,t.user_id).then((function(e){m(""),h("user updated"),a(Object(i.a)(Object(i.a)({},t),e))})).catch((function(e){e.response&&e.response.data?m(e.response.data.error):console.log("Database error",e),h("")}))})),className:"mt-3"},r.a.createElement(ee,{label:"first name",errors:x.firstName,name:"firstName",defVal:t.firstName,maxLen:"50",register:j}),r.a.createElement(ee,{label:"last name",errors:x.lastName,name:"lastName",defVal:t.lastName,maxLen:"50",register:j}),r.a.createElement(ee,{label:"email",errors:x.email,name:"email",defVal:t.email,maxLen:"255",register:j,requirements:{pattern:{value:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{ | }~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,message:"not a valid email"}}}),r.a.createElement(ne,{gender:t.gender,control:y,errors:x}),r.a.createElement(re,{orientation:t.orientation,control:y,errors:x}),r.a.createElement(oe,{name:"tags",state:E,setState:v,control:y,errors:x}),r.a.createElement(le,{bio:t.bio,register:j,errors:x.bio}),r.a.createElement(te,{watch:k,register:j,errors:x}),l&&r.a.createElement("div",{className:"text-danger"},l),p&&r.a.createElement("div",{className:"text-success"},p),r.a.createElement("div",{className:"text-right mt-3"},r.a.createElement(R.a,{type:"submit"},"Update")))},me=function(e){var t=e.user,a=(e.setUser,Object(n.useState)({lat:0,lng:0})),c=Object(u.a)(a,2),o=(c[0],c[1]);Object(n.useEffect)((function(){o({lat:t.latitude,lng:t.longitude})}),[t]);return r.a.createElement("p",null,"map")},fe=a(144),de=a(61),pe=a.n(de),he={addVisit:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/visits",t,v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),visitHistory:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/visits","?to=").concat(t),v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},be=function(e){var t=e.user,a=Object(n.useState)([]),c=Object(u.a)(a,2),o=c[0],l=c[1];return Object(n.useEffect)((function(){he.visitHistory(!1).then((function(e){l(e)})).catch((function(e){console.log("Database error",e)}))}),[t.username]),o&&o.length>0?r.a.createElement(fe.a,{className:"text-left"},o.map((function(e){return r.a.createElement(fe.a.Item,{action:!0,key:e.username},r.a.createElement(m.b,{to:"browse/?user_id=".concat(e.to_user_id)},e.username)," ",r.a.createElement(pe.a,{date:e.date,live:!1}))}))):r.a.createElement("div",{className:"text-info"},"Your visit history is empty")},ge={block:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/block",{to_user_id:t},v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getAllBlocked:function(){var e=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("/api/block",v());case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getBlockedId:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/block","?user_id=").concat(t),v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getBlockedByUser:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat("/api/block","?from_user_id=").concat(t),v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unblockUser:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.delete("".concat("/api/block","/").concat(t),v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Ee=function(e){var t=e.user,a=Object(n.useState)([]),c=Object(u.a)(a,2),o=c[0],l=c[1];Object(n.useEffect)((function(){ge.getBlockedByUser(t.user_id).then((function(e){l(e.filter((function(e){return e.from_user_id===t.user_id})))})).catch((function(e){console.log("Database error",e)}))}),[t.user_id]);return o&&o.length>0?r.a.createElement(fe.a,{className:"text-left",variant:"flush"},o.map((function(e){return r.a.createElement(fe.a.Item,{key:e.username},r.a.createElement("div",{style:{display:"inline-block",width:"60%"}},e.username),r.a.createElement("div",{style:{display:"inline-block",width:"40%",textAlign:"right"}},r.a.createElement(R.a,{onClick:function(){return t=e.block_id,void ge.unblockUser(t).then((function(){l(o.filter((function(e){return e.block_id!==t})))})).catch((function(e){console.log("Database error",e)}));var t},variant:"outline-primary"},"Unblock")))}))):r.a.createElement("div",{className:"text-info"},"Your block list is empty")},ve=function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),c=a[0],o=a[1],l={display:c?"":"none"};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"pb-1 pt-1 d-flex justify-content-between align-items-baseline",onClick:function(){return o(!c)},style:{cursor:"pointer"}},r.a.createElement("span",{className:"font-weight-bold"},e.title||""),r.a.createElement(R.a,{variant:"link"},c?e.hideText||"hide":e.showText||"show")),r.a.createElement("div",{style:l},e.children))},we=function(e){var t=e.user,a=e.setUser;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,t.username),r.a.createElement("div",{className:"text-left pt-3"},r.a.createElement(ve,{title:"Photos"},r.a.createElement(Q,{user:t,setUser:a})),r.a.createElement("hr",null),r.a.createElement(ve,{title:"User information"},r.a.createElement(ue,{user:t,setUser:a})),r.a.createElement("hr",null),r.a.createElement(ve,{title:"Location"},r.a.createElement(me,{user:t,setUser:a})),r.a.createElement("hr",null),r.a.createElement(ve,{title:"Visit history"},r.a.createElement(be,{user:t})),r.a.createElement("hr",null),r.a.createElement(ve,{title:"Blocked users"},r.a.createElement(Ee,{user:t}))))},je=function(e){var t=e.errors,a=e.register,c=e.watch,o=Object(n.useRef)(null),l=Object(n.useRef)(null);o.current=c("birthdate.day",""),l.current=c("birthdate.month","");var s=function(){return t.day&&"required"===t.day.type||t.month&&"required"===t.month.type||t.year&&"required"===t.year.type};return r.a.createElement("div",{className:"text-left"},r.a.createElement(q.a.Label,null,"birthdate"),r.a.createElement("span",{className:"text-danger"}," ",t&&s()&&"*"),r.a.createElement("span",{className:"text-danger"}," ",t&&!s()&&"not a valid date"),r.a.createElement("br",null),r.a.createElement(q.a.Row,null,r.a.createElement(T.a,{xs:3},r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,null,"day"),r.a.createElement(q.a.Control,{name:"birthdate.day",placeholder:"dd",defaultValue:"",maxLength:"2",ref:a({required:!0,maxLength:2})}))),r.a.createElement(T.a,{xs:3},r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,null,"month"),r.a.createElement(q.a.Control,{name:"birthdate.month",placeholder:"mm",defaultValue:"",maxLength:"2",ref:a({required:!0,maxLength:2})}))),r.a.createElement(T.a,{xs:6},r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,null,"year"),r.a.createElement(q.a.Control,{name:"birthdate.year",placeholder:"yyyy",defaultValue:"",maxLength:"4",ref:a({required:!0,maxLength:4,validate:function(e){return function(e){var t=new Date(e,+l.current-1,o.current);return+t&&t.getDate()===+o.current}(e)}})})))))},Oe=function(){var e=Object(X.b)(),t=e.register,a=e.handleSubmit,c=e.errors,o=e.watch,l=Object(n.useState)(""),s=Object(u.a)(l,2),m=s[0],f=s[1],d=Object(n.useState)(""),p=Object(u.a)(d,2),h=p[0],b=p[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",{className:"text-center mt-3 mb-5"},"Signup"),h?r.a.createElement("div",{className:"text-center text-success"},h):r.a.createElement(q.a,{onSubmit:a((function(e,t){var a,n=function(){return Math.random(0).toString(36).substr(2)},r=(a=100,(n()+n()+n()+n()).substr(0,a)),c=Object(i.a)(Object(i.a)({},e),{},{token:r,birthdate:"".concat(e.birthdate.year,"-").concat(e.birthdate.month,"-").concat(e.birthdate.day)});N.createUser(c).then((function(){console.log("user added"),m&&f(""),b("signup succesfull, check your email"),t.target.reset()})).catch((function(e){e.response&&e.response.data?f(e.response.data.error):console.log("Database error",e)}))}))},r.a.createElement(q.a.Row,null,r.a.createElement(T.a,null,r.a.createElement(ee,{label:"first name",errors:c.firstName,name:"firstName",defVal:"",maxLen:"50",register:t})),r.a.createElement(T.a,null,r.a.createElement(ee,{label:"last name",errors:c.lastName,name:"lastName",defVal:"",maxLen:"50",register:t}))),r.a.createElement(ee,{label:"username",errors:c.username,name:"username",defVal:"",maxLen:"255",register:t}),r.a.createElement(je,{register:t,errors:c.birthdate,watch:o}),r.a.createElement(ee,{label:"email",errors:c.email,name:"email",defVal:"",maxLen:"255",register:t,requirements:{pattern:{value:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{ | }~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,message:"not a valid email"}}}),r.a.createElement(te,{watch:o,register:t,errors:c,required:!0}),m&&r.a.createElement("div",{className:"text-center text-danger"},m),r.a.createElement(R.a,{className:"btn-success mt-3",type:"submit"},"Register")))},xe={login:function(){var e=Object(p.a)(d.a.mark((function e(t){var a,n,r,c,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){var t=[];return e?(e.includes("f")&&t.push("female"),e.includes("m")&&t.push("male"),e.includes("o")&&t.push("other"),t):t},e.next=3,b.a.post("/api/login",t);case 3:return n=e.sent,r=n.data,c=r.orientation,o=Object(s.a)(r,["orientation"]),e.abrupt("return",Object(i.a)(Object(i.a)({},o),{},{orientation:a(c)}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},ye=function(e){var t=e.setUser,a=e.wsClient,c=Object(n.useState)(""),o=Object(u.a)(c,2),l=o[0],s=o[1],i=Object(n.useState)(""),f=Object(u.a)(i,2),d=f[0],p=f[1],h=Object(n.useState)(null),b=Object(u.a)(h,2),g=b[0],v=b[1];Object(n.useEffect)((function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(e){e.coords.longitude&&e.coords.latitude&&localStorage.setItem("coordinates",JSON.stringify({latitude:e.coords.latitude,longitude:e.coords.longitude}))}))}),[]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",{className:"text-center mt-3"},"Login"),r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var n=JSON.parse(window.localStorage.getItem("coordinates"));xe.login({username:l,password:d,longitude:n?n.longitude:null,latitude:n?n.latitude:null}).then((function(e){window.localStorage.setItem("loggedMatchaUser",JSON.stringify({sessionToken:e.sessionToken,user_id:e.user_id})),E(e.sessionToken),a.current=L(e.user_id),s(""),p(""),v(null),t(e)})).catch((function(e){e.response&&e.response.data?v(e.response.data.error):console.log("Database error",e)}))}},g&&r.a.createElement("div",{className:"text-danger"},g),r.a.createElement("div",{className:"form-group mt-3"},r.a.createElement("input",{className:"form-control",type:"text",name:"username",value:l,onChange:function(e){var t=e.target;return s(t.value)},placeholder:"Username"})),r.a.createElement("div",{className:"form-group mt-3"},r.a.createElement("input",{className:"form-control",type:"password",name:"password",value:d,onChange:function(e){var t=e.target;return p(t.value)},placeholder:"Password"})),r.a.createElement("button",{className:"btn btn-success mt-3",type:"submit"},"Login"),r.a.createElement("p",{className:"forgot-password text-right"},r.a.createElement(m.b,{to:"/forgot"},"Forgot password?"))))},ke=function(e){var t=e.setUser,a=e.wsClient;return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"text-center text-success"},"account verified"),r.a.createElement(ye,{setUser:t,wsClient:a}))},Ne={forgotPass:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/reset",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),resetPass:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/reset/new-password",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},_e=function(){var e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(null),l=Object(u.a)(o,2),s=l[0],i=l[1],m=Object(n.useState)(null),f=Object(u.a)(m,2),d=f[0],p=f[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",{className:"mt-3"},"Forgot password"),r.a.createElement("div",{className:"align-items-center"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),Ne.forgotPass({email:a}).then((function(e){i(e.message),p(""),c("")})).catch((function(e){p(e.response.data.error),i("")}))}},d&&r.a.createElement("div",{className:"text-danger"},r.a.createElement("strong",null,d)),s&&r.a.createElement("div",{className:"text-success"},r.a.createElement("strong",null,s)),r.a.createElement("div",{className:"form-group mt-3"},r.a.createElement("input",{className:"form-control",type:"text",name:"email",value:a,onChange:function(e){var t=e.target;return c(t.value)},placeholder:"Type your email"})),r.a.createElement("button",{className:"btn btn-success mt-3",type:"submit"},"Submit"))))},Se=function(){var e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(""),l=Object(u.a)(o,2),s=l[0],i=l[1],m=Object(n.useState)(""),f=Object(u.a)(m,2),d=f[0],p=f[1],h=Object(n.useState)(""),b=Object(u.a)(h,2),g=b[0],E=b[1],v=Object(F.i)().token;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",{className:"text-center mt-3"},"Reset your password"),r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),""!==a&&""!==s?a===s?Ne.resetPass({password:a,token:v}).then((function(e){p(e.message),c(""),i(""),E("")})).catch((function(e){E(e.response.data.error),p("")})):E("Password mismatch"):E("All fields must be filled up")}},d&&r.a.createElement("div",{className:"text-success"},r.a.createElement("strong",null,d)),g&&r.a.createElement("div",{className:"text-danger"},r.a.createElement("strong",null,g)),r.a.createElement("div",{className:"form-group mt-3"},r.a.createElement("input",{className:"form-control",type:"password",name:"password",value:a,onChange:function(e){return c(e.target.value)},placeholder:"Type a new password"})),r.a.createElement("div",{className:"form-group mt-3"},r.a.createElement("input",{className:"form-control",type:"password",name:"cpassword",value:s,onChange:function(e){return i(e.target.value)},placeholder:"Confirm new password"})),r.a.createElement("button",{className:"btn btn-success mt-3",type:"submit"},"Submit")))},Ce=a(153),Ue=function(e){var t=e.selected,a=e.handleClick;return r.a.createElement(Ce.a.Link,{href:"#",onClick:a},r.a.createElement(V.a,{icon:B.d,color:t?"gold":"grey"}))},Le=function(e){var t=e.selectedPhoto,a=e.setSelectedPhoto,n=e.profilePic,c=e.photos,o=function(e){return a(c.find((function(t){return t.id===e})))};return r.a.createElement(Ce.a.Body,{className:"text-center"},r.a.createElement(Ue,{selected:t.id===n.id,handleClick:function(){return o(n.id)}}),c.filter((function(e){return!e.profilePic})).map((function(e){return r.a.createElement(Ue,{key:e.id,selected:t.id===e.id,handleClick:function(){return o(e.id)}})})))},Pe=function(e){var t=e.photos,a=Object(n.useState)(null),c=Object(u.a)(a,2),o=c[0],l=c[1],s=t?t.find((function(e){return e.profilePic})):null;Object(n.useEffect)((function(){l(s)}),[s]);var i={selectedPhoto:o,setSelectedPhoto:l,profilePic:s,photos:t};return o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Ce.a.Img,{src:o.photoStr}),r.a.createElement(Le,i))},Fe=a(152),De=a(145),Te=function(){return r.a.createElement(Fe.a,{overlay:r.a.createElement(De.a,{id:"tooltip-disabled"},"You must have a profile picture to like users")},r.a.createElement("span",null,r.a.createElement(R.a,{variant:"link",className:"disabled"},r.a.createElement(V.a,{icon:B.g})," Like")))},Me=function(e){var t=e.action,a=e.icon,n=e.text;return r.a.createElement(R.a,{variant:"link",onClick:function(e){return t(e)}},r.a.createElement(V.a,{icon:a})," ",n)},Ae=function(e){var t=e.action,a=e.icon,n=e.text,c=e.setConfirmationModal,o=e.username;return r.a.createElement(R.a,{variant:"link",onClick:function(){return c({action:t,text:n,username:o})}},r.a.createElement(V.a,{icon:a})," ",n)},Re=function(e){var t=e.liked,a=e.hasPhoto,n=e.likeHandler,c=e.reportHandler,o=e.blockHandler,l=Object(s.a)(e,["liked","hasPhoto","likeHandler","reportHandler","blockHandler"]);return r.a.createElement(Ce.a.Body,null,a||t?r.a.createElement(Me,{action:n,icon:B.g,text:t?" Unlike":" Like"}):r.a.createElement(Te,{likeHandler:n}),r.a.createElement(Ae,Object.assign({action:c,icon:B.f,text:" Report"},l)),r.a.createElement(Ae,Object.assign({action:o,icon:B.b,text:" Block"},l)))},Ve=a(95),Be=function(e){var t=e.user,a=e.isMatch;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ce.a.Body,null,r.a.createElement(Ce.a.Title,null,t.username),r.a.createElement(Ce.a.Text,null,t.firstName," ",t.lastName,", ",t.age),a(t.user_id)&&r.a.createElement(Ce.a.Text,null,r.a.createElement("span",{className:"p-1 border border-info rounded text-info"},"Match")),t.bio.split("\n").map((function(e){return r.a.createElement(Ce.a.Text,{key:e},e)}))),r.a.createElement(fe.a,{className:"list-group-flush"},r.a.createElement(Ve.a,null,t.gender," looking for ",t.orientation.map((function(e,a){return a===t.orientation.length-1?e:a===t.orientation.length-2?"".concat(e," and "):"".concat(e,", ")}))),t.tags&&r.a.createElement(Ve.a,null,t.tags.split("#").map((function(e,t){return t>1?" #".concat(e):1===t?"#".concat(e):null}))),r.a.createElement(Ve.a,null,t.online?r.a.createElement(r.a.Fragment,null,r.a.createElement(V.a,{icon:B.d,color:"green",size:"xs"})," online"):r.a.createElement(r.a.Fragment,null,"last online ",r.a.createElement(pe.a,{date:t.last_online,live:!1})))))},Ie=function(e){var t=e.modal,a=e.setModal;return t&&r.a.createElement(I.a,{show:null!==t,variant:"success",onHide:function(){return a(null)},centered:!0},r.a.createElement(I.a.Header,{closeButton:!0},r.a.createElement(I.a.Title,null,"You got a match!")),r.a.createElement(I.a.Body,null,r.a.createElement(m.b,{to:"/matches"},"You can now chat with ",t)),r.a.createElement(I.a.Footer,null,r.a.createElement(R.a,{onClick:function(){return a(null)}},"Close")))},He=function(e){var t=e.hideUser,a=e.fame;return r.a.createElement(Ce.a.Body,{className:"d-flex justify-content-between"},r.a.createElement("span",{className:"text-primary cursor-pointer",onClick:t},"Back to the list"),r.a.createElement("span",null,r.a.createElement(V.a,{icon:B.a})," ",a,r.a.createElement("br",null)))},Ge=function(e){var t=e.modal,a=e.setModal;return t&&r.a.createElement(I.a,{show:null!==t,variant:"success",onHide:function(){return a(null)},centered:!0},r.a.createElement(I.a.Header,{closeButton:!0},r.a.createElement(I.a.Title,null,t.text)),r.a.createElement(I.a.Body,null,t.text," ",t.username,"?"),r.a.createElement(I.a.Footer,null,r.a.createElement(R.a,{onClick:function(){return a(null)}},"Cancel"),r.a.createElement(R.a,{onClick:t.action},t.text)))},qe={report:function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("/api/report",{to_user_id:t},v());case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},ze=function(e){var t=e.user_id,a=e.loggedUser,c=e.wsClient,o=e.hideUser,l=e.matches,s=e.setMatches,i=e.isMatch,m=Object(n.useState)(!1),f=Object(u.a)(m,2),d=f[0],p=f[1],h=Object(n.useState)(null),b=Object(u.a)(h,2),g=b[0],E=b[1],v=Object(n.useState)(null),w=Object(u.a)(v,2),j=w[0],O=w[1],x=Object(n.useState)(null),y=Object(u.a)(x,2),k=y[0],_=y[1];Object(n.useEffect)((function(){ge.getBlockedId(t).then((function(e){e.length>0?o():N.getUser(t).then((function(e){_(e)})).catch((function(){o()}))})).catch((function(e){console.log("Database error",e)}))}),[t,o]),Object(n.useEffect)((function(){k&&k.user_id!==a.user_id&&(P(c,{user_id:k.user_id,from_id:a.user_id,notification:"".concat(a.username," viewed your profile")}),he.addVisit({to_user_id:k.user_id}).catch((function(e){console.log("Database error",e)})))}),[k,a,c]),Object(n.useEffect)((function(){k&&S.getLike(t).then((function(e){e.length>0&&p(!0)})).catch((function(e){console.log("Database error",e)}))}),[k,t]);var C=function(e){P(c,{user_id:t,from_id:a.user_id,notification:e})},U={liked:d,likeHandler:function(e){e.preventDefault(),S.toggleLike(k.user_id).then((function(e){1===e.value&&"match"===e.status?(C("New match with ".concat(a.username)),E(k.username),s(l.concat({user_id:k.user_id,username:k.username,match:1,messages:[]}))):1===e.value&&"like"===e.status?C("".concat(a.username," likes you")):0===e.value&&"unmatch"===e.status&&(C("No longer match with ".concat(a.username)),s(l.filter((function(e){return e.user_id!==k.user_id})))),p(e.value)})).catch((function(e){console.log("Database error",e)}))},reportHandler:function(){qe.report(t).then((function(){return O(null)})).catch((function(e){console.log("Database error",e)}))},blockHandler:function(){i&&C("No longer match with ".concat(a.username)),ge.block(t).then((function(){window.location.href="http://localhost:3000"})).catch((function(e){console.log("Database error",e)}))},setConfirmationModal:O,hasPhoto:a.photos&&a.photos.length>0,username:k?k.username:""};return k?r.a.createElement(r.a.Fragment,null,r.a.createElement(Ce.a,{className:"w-100 m-auto"},r.a.createElement(He,{fame:k.fame,hideUser:o}),r.a.createElement(Pe,{photos:k.photos}),r.a.createElement(Be,{user:k,isMatch:i}),r.a.createElement(Re,U)),r.a.createElement(Ie,{modal:g,setModal:E}),r.a.createElement(Ge,{modal:j,setModal:O})):null},We=function(e,t,a){var r=Object(n.useState)(window.localStorage.getItem(e)?window.localStorage.getItem(e):t),c=Object(u.a)(r,2),o=c[0],l=c[1];return{type:a,value:o,onChange:function(t){return n=t.target.value,void("number"===a&&(!(n=parseInt(n))||n<0)||(window.localStorage.setItem(e,n),l(n)));var n}}},Je=function(e){var t=e.tags;return r.a.createElement("div",{className:"text-muted d-inline-block text-truncate w-100"},ie(t).map((function(e){return r.a.createElement("span",{key:e.value,className:"tag"},e.value)})))},Ze=function(e){var t=e.users,a=e.handleClick;return t&&t.length>0?r.a.createElement(fe.a,{className:"text-left mt-3",variant:"flush"},t.map((function(e){return r.a.createElement(fe.a.Item,{action:!0,className:"d-flex justify-content-between p-3",key:e.user_id,style:{cursor:"pointer"},onClick:function(){return a(e)}},r.a.createElement("div",{className:"w-75"},e.username,", ",e.age.years,r.a.createElement("br",null),r.a.createElement(Je,{tags:e.tags})),r.a.createElement("div",{className:"text-right"},parseInt(e.distance)," km",r.a.createElement("br",null),r.a.createElement(V.a,{icon:B.a})," ",e.fame))}))):r.a.createElement("div",{className:"text-info mt-3"},"Could not find any matching users")},Ye=function(e){var t=e.user,a=e.resultsToShow,c=e.setResultsToShow,o=Object(n.useCallback)((function(e,a){var n=function(e){var a=t.tags.split("#");return e.split("#").reduce((function(e,t){return a.includes(t)?e+1:e}),-1)};if(e&&0!==e.length){var r=Object(l.a)(e);switch(a){case"age descending":r.sort((function(e,t){return t.age.years-e.age.years}));break;case"age ascending":r.sort((function(e,t){return e.age.years-t.age.years}));break;case"fame":r.sort((function(e,t){return t.fame-e.fame}));break;case"tags":r=e.map((function(e){return e.mutualTags?e:Object(i.a)(Object(i.a)({},e),{},{mutualTags:n(e.tags)})})).sort((function(e,t){return t.mutualTags-e.mutualTags}));break;case"distance":r.sort((function(e,t){return e.distance-t.distance}))}return r}}),[t.tags]);Object(n.useEffect)((function(){var e=window.localStorage.getItem("matchaSortBy")?window.localStorage.getItem("matchaSortBy"):"fame";c((function(t){return o(t,e)}))}),[c,o]);return r.a.createElement(q.a,null,r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"sort-users-field"},"Sort by"),r.a.createElement(q.a.Control,{id:"sort-users-field",as:"select",defaultValue:window.localStorage.getItem("matchaSortBy")?window.localStorage.getItem("matchaSortBy"):"fame",onChange:function(e){window.localStorage.setItem("matchaSortBy",e.target.value),c(o(a,e.target.value))}},r.a.createElement("option",{value:"fame"},"fame"),r.a.createElement("option",{value:"tags"},"mutual tags"),r.a.createElement("option",{value:"age ascending"},"age (from youngest to oldest)"),r.a.createElement("option",{value:"age descending"},"age (from oldest to youngest)"),r.a.createElement("option",{value:"distance"},"distance"))))},$e=function(e){var t=e.user,a=e.requiredTags,n=e.handleTagsChange,c=e.maxDistance,o=e.minFame,l=e.minAge,s=e.maxAge;return r.a.createElement(ve,{showText:"show filters",hideText:"hide filters"},r.a.createElement(q.a,{className:"mb-3"},t.tags?r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"tags-field"},"Tags"),r.a.createElement(ae.a,{isMulti:!0,id:"tags-field",defaultValue:a.value,value:a.value,name:"tags",onChange:n,options:t.tags.split("#").map((function(e){return""===e?{value:"",label:""}:{value:e,label:e}}))})):null,r.a.createElement(q.a.Row,null,r.a.createElement(T.a,null,r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"max-distance-field"},"Max distance"),r.a.createElement(q.a.Control,Object.assign({id:"max-distance-field"},c)))),r.a.createElement(T.a,null,r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"min-fame-field"},"Min fame"),r.a.createElement(q.a.Control,Object.assign({id:"min-fame-field"},o))))),r.a.createElement(q.a.Row,null,r.a.createElement(T.a,null,r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"min-age-field"},"Min age"),r.a.createElement(q.a.Control,Object.assign({id:"min-age-field"},l)))),r.a.createElement(T.a,null,r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"max-age-field"},"Max age"),r.a.createElement(q.a.Control,Object.assign({id:"max-age-field"},s)))))))},Ke=function(e){var t=e.user,a=e.showUser,c=e.users,o=Object(n.useState)([]),l=Object(u.a)(o,2),s=l[0],i=l[1],m=Object(n.useState)(localStorage.getItem("matchaRequiredTags")||[]),f=Object(u.a)(m,2),d=f[0],p=f[1],h=We("matchaMaxDistance",100,"number"),b=We("matchaMinAge",20,"number"),g=We("matchaMaxAge",120,"number"),E=We("matchaMinFame",50,"number");Object(n.useEffect)((function(){i(c)}),[c]);var v=function(e){return e.distance<=h.value&&e.age.years>=b.value&&e.age.years<=g.value&&e.fame>=E.value&&(!((t=e.tags)&&d.length>0)||d.every((function(e){return t.split("#").includes(e)})));var t},w={user:t,resultsToShow:s,setResultsToShow:i},j={user:t,requiredTags:d,handleTagsChange:function(e){return p(e?e.map((function(e){return e.value})):[])},maxDistance:h,minFame:E,minAge:b,maxAge:g};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ye,w),r.a.createElement($e,j),r.a.createElement(Ze,{users:s?s.filter((function(e){return v(e)})):[],handleClick:a}))},Qe=function(e){var t=e.users,a=e.showUser,c=Object(n.useState)([]),o=Object(u.a)(c,2),l=o[0],s=o[1];return Object(n.useEffect)((function(){S.getLikesToUser().then((function(e){s(t.filter((function(t){return e.some((function(e){return e.user_id===t.user_id}))})))})).catch((function(e){console.log("Database error",e)}))}),[t,s]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,"Users that like you"),r.a.createElement(Ze,{users:l,handleClick:a}))},Xe=function(e){var t=e.users,a=e.showUser,c=Object(n.useState)([]),o=Object(u.a)(c,2),l=o[0],s=o[1];return Object(n.useEffect)((function(){he.visitHistory(!0).then((function(e){s(t.filter((function(t){return e.some((function(e){return e.from_user_id===t.user_id}))})))})).catch((function(e){console.log("Database error",e)}))}),[t,s]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,"Users that viewed you"),r.a.createElement(Ze,{users:l,handleClick:a}))},et=function(e){var t=e.user,a=e.wsClient,c=e.showUserAtLoad,o=e.matches,l=e.setMatches,s=Object(n.useState)([]),i=Object(u.a)(s,2),f=i[0],d=i[1],p=Object(n.useState)(c),h=Object(u.a)(p,2),b=h[0],g=h[1],E=Object(F.j)(),v=E.path,w=E.url,j=Object(F.g)();Object(n.useEffect)((function(){g(c)}),[c]),Object(n.useEffect)((function(){N.getByGenderOrientation(t.orientation,t.gender).then((function(e){var t=o?e.filter((function(e){return!o.some((function(t){return t.user_id===e.user_id}))})):e;d(t)})).catch((function(e){console.log("Database error",e)}))}),[t.gender,t.orientation,t.latitude,t.longitude,o]);var O={fontWeight:"bold"},x=function(e){return!!(o&&o.length>0)&&void 0!==o.find((function(t){return t.user_id===e}))},y=function(e){return g(e.user_id)},k={user_id:b,loggedUser:t,wsClient:a,hideUser:function(){x(b)?j.push("/matches"):j.push("/browse"),g(null)},matches:o,setMatches:l,isMatch:x},_={user:t,showUser:y,users:f},S={showUser:y,users:f},C={showUser:y,users:f};return o?b?r.a.createElement(ze,k):r.a.createElement(r.a.Fragment,null,r.a.createElement(Z.a,{className:"mb-5"},r.a.createElement(R.a,{variant:"outline-light"},r.a.createElement(m.c,{exact:!0,to:"".concat(w),activeStyle:O},"All")),r.a.createElement(R.a,{variant:"outline-light"},r.a.createElement(m.c,{to:"".concat(w,"/likes"),activeStyle:O},"Likes")),r.a.createElement(R.a,{variant:"outline-light"},r.a.createElement(m.c,{to:"".concat(w,"/views"),activeStyle:O},"Views"))),r.a.createElement(F.d,null,r.a.createElement(F.b,{exact:!0,path:v,render:function(){return b?null:r.a.createElement(Ke,_)}}),r.a.createElement(F.b,{path:"".concat(v,"/likes")},r.a.createElement(Qe,S)),r.a.createElement(F.b,{path:"".concat(v,"/views")},r.a.createElement(Xe,C)))):null},tt=a(146),at=function(e){var t=e.user,a=e.match,c=e.handleClose,o=e.wsClient,l=Object(n.useState)(""),s=Object(u.a)(l,2),i=s[0],m=s[1],f=Object(n.useRef)(null),d=Object(n.useRef)();return Object(n.useEffect)((function(){f.current&&f.current.scrollIntoView({behavior:"smooth"})}),[a]),a?r.a.createElement(r.a.Fragment,null,r.a.createElement(I.a,{show:!0,onHide:c,onEntered:function(){return d.current.focus()}},r.a.createElement(I.a.Header,{closeButton:!0},r.a.createElement(I.a.Title,null,a.username)),r.a.createElement(I.a.Body,{className:"messageContainer",style:{height:"60vh",overflowY:"auto",paddingBottom:"5vh"}},a.messages.map((function(e){return r.a.createElement(Ce.a,{key:e.id,className:"w-75 mt-2 text-left",style:{marginLeft:t.user_id===e.sender?"25%":"0"}},r.a.createElement(Ce.a.Body,null,e.msg))})),r.a.createElement("div",{ref:f})),r.a.createElement(I.a.Footer,null,r.a.createElement(q.a,{onSubmit:function(e){var n,r,c,l;(e.preventDefault(),i)&&(n=t.user_id,r=t.username,c=a.user_id,l=i,o.current.readyState>1?console.log("Could not send message, websocket state",o.current.readyState):o.current.send(JSON.stringify({type:"message",from:n,user:r,to:c,msg:l})),m(""))},className:"w-100"},r.a.createElement(tt.a,null,r.a.createElement(q.a.Control,{ref:d,placeholder:"write a message as ".concat(t.username," and send"),value:i,onChange:function(e){return m(e.target.value)}}),r.a.createElement(tt.a.Append,null,r.a.createElement("button",{className:"btn btn-primary",type:"submit"},"send"))))))):null},nt=function(e){for(var t=e.messages,a=e.user_id,n=null,c=t.length-1;c>=0;c--)if(t[c].receiver===a){n=t[c].msg;break}return t.length>0&&-1!==c?r.a.createElement("span",{className:"msg-preview d-inline-block text-truncate text-muted"},c===t.length-1?"":r.a.createElement(V.a,{icon:B.i,color:"grey",className:"mr-1"})," ",n):""},rt=function(e){var t=e.user,a=e.matches,n=e.chatToShow,c=e.setChatToShow,o=e.wsClient;return a&&0!==a.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(fe.a,{className:"text-left text-primary",variant:"flush"},a.map((function(e){return r.a.createElement(fe.a.Item,{action:!0,key:e.username,className:"d-flex justify-content-between"},r.a.createElement("div",{className:"w-75 cursor-pointer align-self-center",onClick:function(){return c(e)}},e.username,r.a.createElement("br",null),r.a.createElement(nt,{messages:e.messages,user_id:t.user_id})),r.a.createElement(m.b,{to:"browse?user_id=".concat(e.user_id),className:"p-3 align-self-center chat-profile-link"},r.a.createElement(V.a,{icon:B.l})))}))),r.a.createElement(at,{user:t,match:n,wsClient:o,handleClose:function(){return c(null)}})):r.a.createElement("div",null,"Get some matches to chat")},ct=a(147),ot=a(151),lt=a(97),st=a(150),it=function(e){var t=e.data;return r.a.createElement(r.a.Fragment,null,t.read?null:r.a.createElement(V.a,{icon:B.d,color:"gold",size:"xs",className:"mr-1"}),t.notification)},ut=function(e){var t=e.notifications,a=e.handleNotificationClick,n=e.markAllNotificationsRead;return t?r.a.createElement(st.a,{title:r.a.createElement(r.a.Fragment,null,r.a.createElement(V.a,{icon:B.c,className:"notifications-icon"}),t&&void 0!==t.find((function(e){return!e.read}))?r.a.createElement(V.a,{icon:B.d,color:"gold",className:"unread-notifications-icon"}):null),id:"nav-dropdown",alignRight:!0},r.a.createElement(st.a.Header,null,"Notifications"),(t?t.slice(0,8):[]).map((function(e){return r.a.createElement(st.a.Item,{key:e.id,onClick:function(){return a(e)}},r.a.createElement(it,{data:e,handleClick:a}))})),r.a.createElement(st.a.Divider,{className:"p-0"}),r.a.createElement(st.a.Item,{as:m.b,to:"/notifications",className:"text-primary"},"View all"),r.a.createElement(st.a.Item,{onClick:n,className:"text-primary"},"Mark all as read")):null},mt=function(e,t){localStorage.clear(),e.current.send(JSON.stringify({type:"close",from:t})),window.location.href="/login"},ft=function(e){var t=e.icon,a=e.children,n=Object(s.a)(e,["icon","children"]);return r.a.createElement(ct.a.Link,Object.assign({as:m.c},n),t?r.a.createElement(V.a,{icon:t}):""," ",a)},dt=function(e){var t=e.user,a=e.wsClient,n=e.userInfoComplete,c=Object(s.a)(e,["user","wsClient","userInfoComplete"]);return r.a.createElement(ot.a,{className:"nav",fixed:"top"},r.a.createElement(ct.a,{id:"title"},r.a.createElement(ft,{to:"/",title:"frontpage",icon:lt.a},r.a.createElement("span",{className:"hide-on-mobile"}," matcha"))),t&&t.user_id?n(t)?r.a.createElement(ct.a,null,r.a.createElement(ft,{to:"/matches",title:"chat",icon:B.e}),r.a.createElement(ft,{to:"/profile",title:"your profile",icon:B.l}),r.a.createElement(ft,{to:"/login",title:"logout",onClick:function(){return mt(a,t.user_id)},icon:B.j}),r.a.createElement(ut,c)):null:r.a.createElement(ct.a,null,r.a.createElement(ft,{to:"/signup",title:"signup"},"signup"),r.a.createElement(ft,{to:"/login",title:"login"},"login")))},pt=function(e){var t=e.photo,a=e.setPhoto,c=Object(n.useState)(null),o=Object(u.a)(c,2),l=o[0],s=o[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,{className:"text-center"},t&&t.photoStr?r.a.createElement(A.a,{aspectRatio:"1by1",className:"w-50 m-auto"},r.a.createElement("div",{className:"d-flex"},r.a.createElement(G.a,{src:t.photoStr,alt:"upload preview",title:"upload preview",className:"img-fluid d-block m-auto",style:{maxWidth:"100%",maxHeight:"100%"}}))):null,t&&t.profilePic?null:r.a.createElement(q.a.Group,null,r.a.createElement(q.a.Label,{htmlFor:"photo-upload",className:"btn btn-primary mt-3"},"Choose photo"),r.a.createElement(q.a.Control,{id:"photo-upload",type:"file",accept:".png, .jpg, .jpeg",onChange:function(e){e.preventDefault();var t=new FileReader,n=e.target.files[0];n&&(n.size>35e4?s("Max photo size is 350kb"):(t.onloadend=function(){a({photoStr:t.result})},t.readAsDataURL(n),s("")))},className:"w-50 m-auto"})),l&&r.a.createElement("div",{className:"text-center text-danger"},l)))},ht=function(e){var t=e.user,a=e.setUser,c=Object(n.useState)({}),o=Object(u.a)(c,2),l=o[0],s=o[1],m=Object(X.b)(),f=m.register,d=m.handleSubmit,p=m.errors,h=m.control,b=Object(n.useState)({value:ie(t.tags),inputValue:""}),g=Object(u.a)(b,2),E=g[0],v=g[1];Object(n.useEffect)((function(){t.photos&&t.photos.length>0&&s(t.photos.find((function(e){return e.profilePic})))}),[t.photos]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"text-info text-center mb-3"},"Fill your info to start matching!"),r.a.createElement(pt,{photo:l,setPhoto:s}),r.a.createElement(q.a,{onSubmit:d((function(e){var n=Object(i.a)({},e);n.gender=e.gender.value,n.orientation=se(e.orientation),n.tags=E.value&&0!==E.value.length?E.value.map((function(e){return e.value})).join(""):"",N.updateUser(n,t.user_id).then((function(e){if(l&&!l.profilePic){var n=Object(i.a)({user_id:t.user_id,profilePic:1},l);H.addPhoto(n).then((function(r){var c=Object(i.a)(Object(i.a)({},t),e);c.photos=t.photos?t.photos.concat(Object(i.a)(Object(i.a)({},n),r)):[Object(i.a)(Object(i.a)({},n),r)],a(c)})).catch((function(e){console.log("Database error",e)}))}else a(Object(i.a)(Object(i.a)({},t),e))})).catch((function(e){console.log("Database error",e)}))})),className:"mt-3"},r.a.createElement(ne,{gender:t.gender,control:h,errors:p}),r.a.createElement(re,{orientation:t.orientation,control:h,errors:p}),r.a.createElement(oe,{name:"tags",state:E,setState:v,control:h,errors:p}),r.a.createElement(le,{bio:t.bio,register:f,errors:p.bio}),r.a.createElement(R.a,{className:"mt-3",type:"submit"},"Update")))},bt=function(e){var t=e.notifications,a=e.handleClick,n=e.markAllAsRead;return t?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"text-right mb-3"},r.a.createElement(R.a,{variant:"link",className:"text-primary",onClick:n},"Mark all as read")),r.a.createElement(fe.a,{className:"text-left cursor-pointer",variant:"flush"},t.map((function(e){return r.a.createElement(fe.a.Item,{key:e.id,onClick:function(){return a(e)}},r.a.createElement(it,{data:e}))})))):null},gt=function(e){var t=e.user,a=e.setUser,c=e.matches,o=e.setMatches,l=e.notifications,s=e.setNotifications,u=e.chatToShow,m=e.setChatToShow,f=e.wsClient,d=Object(F.g)(),p=Object(F.h)();Object(n.useEffect)((function(){t.user_id&&_.getNotifications(t.user_id).then((function(e){s(e)})).catch((function(e){console.log("Database error",e)}))}),[t.user_id,s]);var h=function(e){return e.firstName&&e.lastName&&e.username&&e.email&&e.gender&&e.orientation},b=function(e){_.markAsRead(e.id).then((function(){e.notification.endsWith("viewed your profile")||e.notification.endsWith("likes you")?d.push("browse/?user_id=".concat(e.from_id)):(e.notification.startsWith("New message from")||e.notification.startsWith("New match with")||e.notification.startsWith("No longer match with"))&&d.push("/matches"),s(l.map((function(t){return t.id===e.id?Object(i.a)(Object(i.a)({},t),{},{read:1}):t})))}))},g=function(){_.markAllAsRead(t.user_id).then((function(){s(l.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{read:1})})))})).catch((function(e){console.log("Database error",e)}))},E={user:t,matches:c,chatToShow:u,setChatToShow:m,wsClient:f},v={notifications:l,handleNotificationClick:b,markAllNotificationsRead:g},w=Object(i.a)({user:t,wsClient:f,userInfoComplete:h},v),j={user:t,setUser:a};return r.a.createElement(r.a.Fragment,null,r.a.createElement(dt,w),r.a.createElement(D.a,{id:"main-container",fluid:"lg"},r.a.createElement("div",{id:"middle-column"},r.a.createElement(F.d,null,r.a.createElement(F.b,{exact:!0,path:"/",render:function(){return t.user_id?h(t)?r.a.createElement(F.a,{to:"/browse"}):r.a.createElement(ht,j):r.a.createElement(F.a,{to:"/login"})}}),r.a.createElement(F.b,{path:"/browse",render:function(){var e=p&&p.search.indexOf("user_id=")&&Number(p.search.substring(p.search.indexOf("user_id=")+8))?Number(p.search.substring(p.search.indexOf("user_id=")+8)):null;return t.user_id&&h(t)?r.a.createElement(et,{user:t,wsClient:f,showUserAtLoad:e,matches:c,setMatches:o}):r.a.createElement(F.a,{to:"/"})}}),r.a.createElement(F.b,{path:"/signup",component:Oe}),r.a.createElement(F.b,{path:"/forgot",component:_e}),r.a.createElement(F.b,{path:"/reset-password/:token",component:Se}),r.a.createElement(F.b,{path:"/login",render:function(){return t.user_id?r.a.createElement(F.a,{to:"/"}):r.a.createElement(ye,{setUser:a,wsClient:f})}}),r.a.createElement(F.b,{path:"/verify",render:function(){return t.user_id?r.a.createElement(F.a,{to:"/"}):r.a.createElement(ke,{setUser:a,wsClient:f})}}),r.a.createElement(F.b,{path:"/profile",render:function(){return t.user_id&&h(t)?r.a.createElement(we,{user:t,setUser:a}):r.a.createElement(F.a,{to:"/"})}}),r.a.createElement(F.b,{path:"/matches",render:function(){return t.user_id?r.a.createElement(rt,E):r.a.createElement(F.a,{to:"/"})}}),r.a.createElement(F.b,{path:"/notifications",render:function(){return t.user_id?r.a.createElement(bt,{notifications:l,handleClick:b,markAllAsRead:g}):r.a.createElement(F.a,{to:"/"})}})))),r.a.createElement("footer",null,r.a.createElement(D.a,{fluid:"lg"},"lapaset & mhjony 2020")))},Et=(a(132),function(){var e=Object(n.useState)({}),t=Object(u.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(null),f=Object(u.a)(o,2),d=f[0],p=f[1],h=Object(n.useState)(null),b=Object(u.a)(h,2),g=b[0],v=b[1],w=Object(n.useState)(null),j=Object(u.a)(w,2),O=j[0],x=j[1],y=Object(n.useRef)({}),k=Object(n.useRef)(!0),U={user:a,setUser:c,matches:d,setMatches:p,notifications:g,setNotifications:v,chatToShow:O,setChatToShow:x,wsClient:y};return Object(n.useEffect)((function(){var e=window.localStorage.getItem("loggedMatchaUser");if(e){var t=JSON.parse(e);return E(t.sessionToken),N.getUser(t.user_id).then((function(e){y.current=L(t.user_id),k.current=!1,c(e)})).catch((function(e){console.log("Database error",e)})),function(){y.current.send(JSON.stringify({type:"close",from:t.user_id}))}}k.current=!1,c({})}),[]),Object(n.useEffect)((function(){a.user_id&&S.getMatches(a.user_id).then((function(e){if(e.length<1)p([]);else{var t=e.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{messages:[]})}));C.getChatHistory().then((function(e){e.forEach((function(e){var a=t.find((function(t){return t.user_id===e.sender||t.user_id===e.receiver}));a&&a.messages.push(e)})),p(t)})).catch((function(e){console.log("Database error",e)}))}})).catch((function(e){console.log("Database error",e)}))}),[a.user_id]),Object(n.useEffect)((function(){y.current.onmessage=function(e){var t=JSON.parse(e.data),n=t.type,r=Object(s.a)(t,["type"]);if("message"===n||"rejected"===n){var c=Object(l.a)(d),o=c.find((function(e){return e.user_id===r.sender||e.user_id===r.receiver}));if(!o)return;o.messages.push(r),"message"===n&&(r.receiver!==a.user_id||O&&O.user_id===o.user_id?p(c):P(y,{user_id:a.user_id,from_id:o.user_id,notification:"New message from ".concat(o.username)})),"rejected"===n&&r.sender===a.user_id&&_.notify({user_id:r.receiver,from_id:r.sender,notification:"New message from ".concat(a.username)}).then((function(){p(c)})).catch((function(e){console.log("Database error",e)}))}if("notification"===n&&g){if(r.notification.startsWith("New match with")){var u={user_id:r.from_id,username:r.notification.slice(15),match:1,messages:[]};p(d.concat(u))}r.notification.startsWith("No longer match with")&&p(d.filter((function(e){return e.user_id!==r.from_id})));var m=Object(l.a)(g);m.unshift(Object(i.a)({},r)),v(m)}}}),[d,a.user_id,O,y,g,v,a.username]),k.current?null:r.a.createElement(m.a,null,r.a.createElement(gt,U))});o.a.render(r.a.createElement(Et,null),document.getElementById("root"))},98:function(e,t,a){e.exports=a(133)}},[[98,1,2]]]);
//# sourceMappingURL=main.de896d75.chunk.js.map